<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<title>Generatore PDF - Accordo IMA Life</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI', Arial, sans-serif; background:#f5f5f5; min-height:100vh; padding:30px; color:#333; }
.container { max-width:1400px; margin:0 auto; }
.controls { background:#fff; border-radius:12px; padding:30px; margin-bottom:30px; box-shadow:0 4px 20px rgba(0,0,0,0.1); }
.controls h2 { font-size:28px; margin-bottom:25px; color:#2d3748; display:flex; align-items:center; gap:10px; }
.section-card { background:#fafafa; border-radius:10px; padding:20px; margin-bottom:20px; border-left:4px solid #4a5568; transition:all 0.3s ease; }
.section-card:hover { box-shadow:0 4px 15px rgba(0,0,0,0.08); transform:translateY(-1px); }
.section-header { display:flex; align-items:center; gap:10px; font-size:16px; font-weight:600; color:#4a5568; margin-bottom:15px; }
.section-icon { width:28px; height:28px; border-radius:6px; display:flex; align-items:center; justify-content:center; font-size:16px; }
.icon-purple { background:#6b7280; color:white; }
.icon-blue { background:#3b82f6; color:white; }
.icon-green { background:#10b981; color:white; }
.icon-orange { background:#f59e0b; color:white; }
.icon-red { background:#ef4444; color:white; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; margin-bottom:6px; font-weight:600; color:#4a5568; font-size:14px; }
.form-row { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px; }
select, input[type="text"], input[type="number"], input[type="date"], textarea { width:100%; padding:10px 14px; border:1px solid #d1d5db; border-radius:6px; font-size:14px; transition:all 0.2s ease; background:white; }
select:focus, input:focus, textarea:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
textarea { resize:vertical; min-height:70px; }
.code-preview { padding:16px; background:#374151; border-radius:8px; font-family:'Courier New', monospace; font-size:16px; font-weight:bold; color:white; margin-top:10px; text-align:center; }
.table-section { background:white; padding:15px; border:1px solid #d1d5db; border-radius:8px; margin-top:10px; }
.btn { background:#3b82f6; color:white; border:none; padding:12px 28px; border-radius:8px; cursor:pointer; font-size:15px; font-weight:600; transition:all 0.2s ease; display:inline-flex; align-items:center; gap:6px; }
.btn:hover { background:#2563eb; transform:translateY(-1px); }
.btn-secondary { background:#6b7280; }
.btn-secondary:hover { background:#4b5563; }
.button-group { display:flex; gap:12px; margin-top:20px; flex-wrap:wrap; }
.pdf-page { width:210mm; min-height:297mm; background:white; margin:20px auto; padding:20mm 25mm; box-shadow:0 0 10px rgba(0,0,0,0.1); position:relative; color:#000; }
.header { display:flex; justify-content:space-between; margin-bottom:15px; }
.header-date { font-size:11pt; }
.doc-code { font-size:10pt; font-weight:bold; margin-bottom:3px; }
.order-number { font-size:9pt; margin-bottom:15px; }
.title { font-size:12pt; font-weight:bold; text-align:center; margin-bottom:20px; line-height:1.4; text-transform:uppercase; }
.toc { margin-bottom:20px; }
.toc-title { font-size:11pt; font-weight:bold; margin-bottom:8px; }
.toc-item { font-size:10pt; margin-bottom:2px; display:flex; justify-content:space-between; }
.section { margin-bottom:15px; }
.section-title { font-size:11pt; font-weight:bold; margin-bottom:6px; }
.section-content { font-size:10pt; line-height:1.5; text-align:justify; margin-bottom:5px; }
.equipment-notes { font-size:10pt; line-height:1.5; margin-top:10px; font-style:italic; white-space: pre-wrap; text-align:center; }
.data-table { width:100%; border-collapse:collapse; margin:10px 0; font-size:10pt; }
.data-table th, .data-table td { border:1px solid #000; padding:6px; text-align:center; }
.data-table th { background:#e5e7eb; font-weight:bold; }
.footer { position:absolute; bottom:20mm; left:25mm; right:25mm; border-top:1px solid #000; padding-top:6px; font-size:9pt; font-weight:bold; text-align:center; }
.signature-grid { display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-top:30px; }
.sig-box { border-top:1px solid #000; padding-top:8px; font-size:10pt; min-height:70px; }
@media print { body { background:white; padding:0; } .controls { display:none; } }

#togglePdfBtn {
    position: fixed;
    bottom: 30px;       /* distanza dal basso */
    right: 30px;        /* distanza dal lato destro */
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: none;
    background: #3b82f6;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
}
#togglePdfBtn:hover {
    background: #2563eb;
    transform: scale(1.1);
}

</style>
</head>
<body>

<script>
// Inserisco tutto il contenuto dinamico con document.write
document.write(`
<div class="container">


<button id="togglePdfBtn" title="Mostra/Nascondi documento">üìÑ</button>

<div class="controls">
<h2>üìã Dashboard Generatore PDF Accordo IMA Life</h2>

<div class="section-card">
<div class="section-header"><div class="section-icon icon-purple">üìÑ</div><span>1. Codice Documento</span></div>
<div class="form-row">
<div class="form-group"><label>Training</label><select id="docType"><option value="MA">Machine</option><option value="LP">Line Production</option><option value="CO">Changeover</option><option value="SC">SCADA Sup</option><option value="PR">Process</option><option value="AU">Automation</option><option value="MG">MG</option><option value="AO">AddOn</option></select></div>
<div class="form-group"><label>Codice</label><input type="text" id="docNumber" maxlength="4"></div>
<div class="form-group"><label>Tipo Ag.</label><select id="tipoAg"><option value="">-</option><option value="A">A</option><option value="B">B</option><option value="C">C</option></select></div>
<div class="form-group"><label>Fornitore</label><select id="supplier"><option value="TIMAGE">TIMAGE</option><option value="TWEDDLE">TWEDDLE</option></select></div>
</div>

<div class="form-row">
<div class="form-group"><label>Linea</label><input type="text" id="lineCode" placeholder="es. SL1000"></div>
<div class="form-group"><label>Cliente</label><input type="text" id="customerName" placeholder="NOME CLIENTE"></div>
<div class="form-group"><label>Nazione</label><input type="text" id="countryName"></div>
<div class="form-group"><label>Revisione</label><input type="number" id="revisionNum" value="1" min="1"></div>
</div>

<div class="code-preview" id="codePreview">...</div>
</div>

<div class="section-card">
<div class="section-header"><div class="section-icon icon-blue">üî¢</div><span>2. Ordine di Servizio</span></div>
<div class="form-group"><label>Numero Ordine</label><input type="text" id="orderNumber"></div>
</div>

<div class="section-card">
<div class="section-header"><div class="section-icon icon-green">üì¶</div><span>3. Tabella Prodotti</span></div>
<div class="table-section">
<div class="form-row">
<div class="form-group"><label>N¬∞ Equipment</label><input type="number" id="prodEquip"></div>
<div class="form-group"><label>Lingue</label><input type="text" id="prodLang" placeholder="ITA, ENG"></div>
</div>
<div class="form-group"><label>Note Equipment</label><textarea id="equipNoteInput" placeholder="Dettagli equipment..."></textarea></div>
</div>
</div>

<div class="section-card">
<div class="section-header"><div class="section-icon icon-orange">üí∞</div><span>4. Gestione Costi</span></div>
<div class="form-row">
<div class="form-group"><label>Cifra numerica</label><input type="text" id="costNumeric"></div>
<div class="form-group"><label>Cifra in lettere</label><input type="text" id="costLiteral"></div>
</div>
</div>

<div class="section-card">
<div class="section-header"><div class="section-icon icon-red">üìÖ</div><span>7. Tempi di Consegna</span></div>
<div class="form-group"><label>Data di consegna</label><input type="date" id="deliveryDate"></div>
</div>

<div class="button-group">
<button class="btn" onclick="generatePDF()"><span>üñ®Ô∏è</span> Genera PDF</button>
<button class="btn btn-secondary" onclick="resetForm()"><span>üîÑ</span> Reset</button>
</div>
</div>
`);
</script>

<div id="pdfPages"></div>

<script>
// Generazione dinamica delle 6 pagine PDF
const pdfHTML = `
<div class="pdf-page">
<div class="header"><div class="header-date date-val">08/10/2025</div></div>
<div class="doc-code code-val">...</div>
<div class="order-number">Ordine Di Servizio per fatturazione: <span class="order-val">...</span></div>
<div class="title">ACCORDO* TRA IMA LIFE E FORNITORI TERZI PER LA CREAZIONE E<br>LO SVILUPPO DI CONTENUTI TRAINING E/O EVENTUALI GUIDE<br>DIGITALI CORRELATE NONCH√â PER LA LORO ELABORAZIONE<br>DIGITALE E REALIZZAZIONE SU PIATTAFORMA SKILLGATE</div>
<div class="toc">
<div class="toc-title">Sommario:</div>
<div class="toc-item"><span>1. INTRODUZIONE</span><span>2</span></div>
<div class="toc-item"><span>2. GLOSSARIO</span><span>2</span></div>
<div class="toc-item"><span>3. SCOPO E PRODOTTO</span><span>2</span></div>
<div class="toc-item"><span>4. COSTI</span><span>3</span></div>
<div class="toc-item"><span>5. MODALIT√Ä DI RICHIESTA</span><span>3</span></div>
<div class="toc-item"><span>6. MODALIT√Ä DI ACCETTAZIONE E PRESA IN CARICO</span><span>3</span></div>
<div class="toc-item"><span>7. TEMPI DI CONSEGNA</span><span>3</span></div>
<div class="toc-item"><span>8. METODO DI CONSEGNA</span><span>4</span></div>
<div class="toc-item"><span>9. METODO DI PAGAMENTO E REVISIONI DI COSTO</span><span>4</span></div>
<div class="toc-item"><span>10. RESPONSABILIT√Ä DEL FORNITORE</span><span>4</span></div>
<div class="toc-item"><span>11. PROPRIET√Ä INTELLETTUALE</span><span>4</span></div>
<div class="toc-item"><span>12. CLAUSOLA DI RISERVATEZZA</span><span>5</span></div>
<div class="toc-item"><span>13. RISOLUZIONE DEL CONTRATTO</span><span>5</span></div>
</div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 1 di 6</div>
</div>

<div class="pdf-page">
<div class="header"><div class="header-date date-val">...</div></div>
<div class="section"><div class="section-title">1. INTRODUZIONE</div><div class="section-content">Il presente documento regola gli accordi tra IMA Life e il fornitore per la creazione e lo sviluppo di contenuti, nonch√© per la loro elaborazione e digitalizzazione, finalizzati alla creazione di MATERIALE DI TRAINING E GUIDE DIGITALI CORRELATE (OG/MG‚Ä¶) sulla piattaforma IMA Skillgate per conto di IMA Life.</div></div>
<div class="section"><div class="section-title">2. GLOSSARIO</div>
<table class="data-table" style="width:auto;margin-left:0">
<tr><td style="text-align:left;font-weight:bold;width:150px">PRODOTTO</td><td style="text-align:left">Elaborazione e digitalizzazione di contenuti FORMATIVI</td></tr>
<tr><td style="text-align:left;font-weight:bold">GUIDE DIGITALI</td><td style="text-align:left">Maintenance Guide, Operative Guide o altra tipologia definita da IMA Life</td></tr>
</table>
<div class="section-content">Tutti gli altri eventuali termini tecnici e acronimi rimanenti impiegati nel presente documento sono spiegati all'atto del loro utilizzo</div></div>
<div class="section"><div class="section-title">3. SCOPO E PRODOTTO</div><div class="section-content">Il presente accordo disciplina la creazione di PRODOTTI formativi, inclusi analisi, raccolta dati, sviluppo, elaborazione e digitalizzazione di contenuti, oltre a eventuali guide digitali. Il processo segue le fasi descritte nel documento "00_Training e Guide Digitali_Doc Mastro". Il fornitore garantisce la disponibilit√† di risorse dedicate in base alle esigenze e alle scadenze (punto 5). Si impegna a sviluppare o adattare contenuti da progetti esistenti, mentre il cliente (IMA Life) si impegna al pagamento secondo quanto stabilito al punto 4. I prodotti da realizzare, le relative quantit√† e la lingua richiesta sono specificati di seguito.</div>
<div class="section-content" style="margin-top:15px">- Analisi, elaborazione, sviluppo storyboard, digitalizzazione e pubblicazione su piattaforma dei contenuti formativi riferiti ai seguenti tipi di corso e per i macchinari evidenziati:</div>
<table class="data-table"><thead><tr><th style="width:33%">PROD. TYPE</th><th style="width:33%">EQUIP.</th><th style="width:33%">LINGUE</th></tr></thead><tbody><tr><td class="prod-type-val">-</td><td class="equip-val">-</td><td class="lang-val">-</td></tr></tbody></table>
<div id="pdfEquipNotes" class="equipment-notes"></div>
</div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 2 di 6</div>
</div>

<div class="pdf-page">
<div class="header"><div class="header-date date-val">...</div></div>
<div class="section"><div class="section-content">- Raccolta, analisi, creazione sviluppo, digitalizzazione, verifica e traduzione dei contenuti come specificato ai punti 1, 2, 3, 4, 5, 6, 7, 8 e 9 del flusso di lavoro presente al paragrafo 3.4 Scenari di Gestione del documento '00_Training e Guide Digitali_Doc Mastro'<br>- fatte salve richieste differenti per casi specifici definiti da IMA Life, la fornitura avverr√† in uno o pi√π pacchetti definiti dalle esigenze</div>
<div class="section-title">4. COSTI</div><div class="section-content">IMA Life propone al fornitore un costo a pacchetto OMNICOMPRENSIVO ED ESAUSTIVO a copertura degli oneri di creazione e sviluppo del/i contenuto/i assegnato/i pari ad euro:</div>
<div class="section-content" style="font-weight:bold;text-align:center;padding:10px;border:1px solid #000;margin:10px 0">Euro <span id="spanCostNumeric">00.000,00</span> ‚Ç¨ (<span id="spanCostLiteral">xxxxxxxxxx</span> euro)</div>
<div class="section-content">Per attivit√† di RACCOLTA INFORMAZIONI, SVILUPPO STORYBOARD e DIGITALIZZAZIONE in accordo con il modello standard di riferimento per MACHINE. Il pagamento avverr√† in n¬∞ 3 parti, pari ognuna al 33,3% del totale, ad intervalli regolari. L'ultima quota verr√† riconosciuta a fine progetto.<br><br><strong>La proposta include lo svolgimento di mansioni quali l'analisi della richiesta, raccolta informazioni, reperimento materiale e strutturazione del/i contenuto/i, revisione e/o validazione del/gli stesso/i, e quant'altro occorrente alla sua/loro creazione non espressamente menzionato per tutti i Prodotti e le quantit√† cos√¨ come indicate al punto 3.<br>La proposta NON include eventuali ore di supporto a carico di IMA in caso il fornitore mostri comprovata mancanza nella presa visione e aderenza alle regole e ai metodi definiti da IMA Life condivisi nell'apposita area collaborativa.</strong></div></div>
<div class="section"><div class="section-title">5. MODALIT√Ä DI RICHIESTA</div><div class="section-content">La richiesta di creazione del PRODOTTO avverr√† tramite comunicazione scritta (e-mail), a cui sar√† allegato il presente documento e/o altri documenti aggiuntivi, se necessari allo scopo, indicanti Prodotto, Quantit√†, Budget, Tempistiche, Modalit√† e/o qualsiasi altro elemento utile alla definizione del progetto.</div></div>
<div class="section"><div class="section-title">6. MODALIT√Ä DI ACCETTAZIONE E PRESA IN CARICO</div><div class="section-content">L'accettazione di tale accordo dovr√† avvenire esclusivamente in <strong>forma scritta</strong>: condividendo <strong>copia firmata</strong> del presente documento oppure formalizzando l'accettazione tramite <strong>risposta scritta da parte del Responsabile Commerciale di Progetto.</strong> La risposta dovr√† pervenire entro <strong>2 (due) giorni lavorativi</strong>, oltre i quali IMA si riserva di considerare l'offerta decaduta.</div></div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 3 di 6</div>
</div>

<div class="pdf-page">
<div class="header"><div class="header-date date-val">...</div></div>
<div class="section"><div class="section-title">7. TEMPI DI CONSEGNA</div><div class="section-content" id="pdfDeliveryText">Il fornitore si impegna a consegnare i prodotti finiti entro e non oltre il ven 19 dicembre 25, salvo diverso accordo scritto.<br>La mancata consegna nei termini concordati dar√† diritto a IMA Life di:<br><br>- Rivedere il budget assegnato.<br>- Rescindere il contratto in caso di ritardi gravi.</div>
<div class="section-title">8. METODO DI CONSEGNA</div><div class="section-content">La merce si intende consegnata quando:<br><br>- Il corso √® stato pubblicato sulla piattaforma LMS, verificato e validato in termini di veridicit√† e completezza dell'informazione (per il target di riferimento), comprensione del contenuto e User Experience.<br>- Qualora richiesto, il corso √® stato reso disponibile in multilingua e verificato in termini di completezza dell'informazione, correttezza dei termini, comprensione e User Experience.<br><br><strong>NB: Alla chiusura del progetto si richiede di inviare una mail finale con l'elenco dei validatori, includendo nome e cognome e data di validazione di ciascuno step.</strong><br><br><strong>Il fornitore √® tenuto a seguire rigorosamente le linee guida e i requisiti stabiliti dalla Divisione per la creazione e lo sviluppo di Training e Guide Digitali. Tutti i contenuti utili allo sviluppo del prodotto devono essere condivisi nell'apposita area collaborativa e pubblicati nella loro forma finale sulla piattaforma IMA SkillGate, secondo i flussi e le regole standard definite e condivise.</strong><br><br>I membri del Board IMA Life manterranno sempre il diritto di controllare ogni fase del processo e potranno intervenire in qualsiasi momento, anche a progetto concluso, per segnalare eventuali deviazioni dai requisiti di progetto o inesattezze nelle informazioni riportate. Le eventuali correzioni causate dal mancato rispetto dei requisiti non saranno a carico del Board, n√© dal punto di vista economico n√© per quanto riguarda la parte tecnico-operativa.</div></div>
<div class="section"><div class="section-title">9. METODO DI PAGAMENTO E REVISIONI DI COSTO</div><div class="section-content">Il pagamento avverr√† al completamento del progetto dopo opportuna verifica di conformit√†, salvo diverso accordo come indicato al punto 4.<br>Se, durante lo sviluppo del progetto, si rendessero necessarie revisioni o modifiche che non rientrano nei flussi e nelle regole standard concordate, il fornitore dovr√†:<br><br>- Comunicare per iscritto tale necessit√†, includendo una stima dei relativi costi aggiuntivi.<br>- Ottenere l'approvazione scritta di IMA Life prima di procedere con l'implementazione delle modifiche.</div></div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 4 di 6</div>
</div>

<div class="pdf-page">
<div class="header"><div class="header-date date-val">...</div></div>
<div class="section"><div class="section-title">10. RESPONSABILIT√Ä DEL FORNITORE</div><div class="section-content">Il fornitore garantisce di disporre di risorse adeguate per completare il progetto nei tempi e nelle modalit√† stabilite. Qualora non fosse in grado di rispettare tali impegni, IMA Life si riserva il diritto di:<br><br>- <strong>Decurtare</strong> parte del valore dell'accordo per ogni settimana di ritardo (laddove questo non fosse stato comunicato e approvato in forma scritta con almeno due settimane di anticipo), fino a un massimo da definire commisurato al grado di inadempienza valutata da IMA Life<br>- <strong>Revocare</strong> l'incarico senza obbligo di pagamento qualora il ritardo (non comunicato e approvato in forma scritta) superi i 30 giorni lavorativi.</div>
<div class="section-title">11. PROPRIET√Ä INTELLETTUALE</div><div class="section-content">Tutti i materiali prodotti (inclusi file sorgente, testi, immagini, video, e-learning) <strong>saranno di esclusiva propriet√† di IMA Life.</strong> Il fornitore non potr√† riutilizzare, modificare o divulgare tali contenuti <strong>senza autorizzazione scritta.</strong></div></div>
<div class="section"><div class="section-title">12. CLAUSOLA DI RISERVATEZZA</div><div class="section-content">Il fornitore si impegna a trattare tutte le informazioni ricevute come strettamente confidenziali e a non divulgarle a terzi senza l'approvazione scritta di IMA Life. Qualsiasi violazione comporter√† una penale oltre al risarcimento per eventuali danni.</div></div>
<div class="section"><div class="section-title">13. RISOLUZIONE DEL CONTRATTO</div><div class="section-content">IMA Life si riserva il diritto di risolvere il contratto con effetto immediato in caso di:<br><br>- Ritardi superiori a 30 giorni lavorativi rispetto a quanto concordato (vedi punto 10).<br>- Violazione della riservatezza o uso improprio dei contenuti.<br>- Inadempienza contrattuale grave.</div></div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 5 di 6</div>
</div>

<div class="pdf-page">
<div class="header"><div class="header-date date-val">...</div></div>
<div class="section-content" style="margin-top:50px">Per accettazione dei termini e delle condizioni sopra descritti.</div>
<div class="signature-grid">
<div><strong>Per IMA LIFE S.r.l.</strong><br><br><div class="sig-box">Firma del Responsabile di Progetto</div><div style="font-size:9pt;margin-top:5px">Data: <span class="date-val">...</span></div></div>
<div><strong>Per il FORNITORE (<span class="supplier-name-val">...</span>)</strong><br><br><div class="sig-box">Firma del Responsabile Legale/Commerciale</div><div style="font-size:9pt;margin-top:5px">Data: __________</div></div>
</div>
<div class="footer">ACCORDO IMA LIFE ‚Äì FORNITORI<br>REV.<span class="rev-val">1</span> PER LA PRODUZIONE MATERIALE DI TRAINING Pagina 6 di 6</div>
</div>
`;

document.getElementById('pdfPages').innerHTML = pdfHTML;

function numeroInLettere(num) {
    if (num === 0) return "ZERO";
    const unit√† = ["", "UNO", "DUE", "TRE", "QUATTRO", "CINQUE", "SEI", "SETTE", "OTTO", "NOVE"];
    const decine = ["", "DIECI", "VENTI", "TRENTA", "QUARANTA", "CINQUANTA", "SESSANTA", "SETTANTA", "OTTANTA", "NOVANTA"];
    const speciali = ["DIECI", "UNDICI", "DODICI", "TREDICI", "QUATTORDICI", "QUINDICI", "SEDICI", "DICIASSETTE", "DICIOTTO", "DICIANNOVE"];
    function converti(n) {
        let res = "";
        if (n >= 100) {
            let h = Math.floor(n / 100);
            res += (h > 1 ? unit√†[h] : "") + "CENTO";
            n %= 100;
        }
        if (n >= 20) {
            let d = Math.floor(n / 10);
            let u = n % 10;
            let dec = decine[d];
            if (u === 1 || u === 8) dec = dec.substring(0, dec.length - 1);
            res += dec + unit√†[u];
        } else if (n >= 10) {
            res += speciali[n - 10];
        } else if (n > 0) {
            res += unit√†[n];
        }
        return res;
    }
    let result = "";
    let n = Math.floor(num);
    if (n >= 1000000) {
        let m = Math.floor(n / 1000000);
        result += (m === 1 ? "UNMILIONE" : converti(m) + "MILIONI");
        n %= 1000000;
    }
    if (n >= 1000) {
        let k = Math.floor(n / 1000);
        if (k === 1) result += "MILLE";
        else result += converti(k) + "MILA";
        n %= 1000;
    }
    result += converti(n);
    return result;
}

function padNumber(str, length=4) {
    str = String(str || '');
    while (str.length < length) str = '0' + str;
    return str;
}

function getSupplierInitials(s) {
    if (!s) return '';
    const val = s.toUpperCase();
    if (val.includes('TIMAGE')) return 'TM';
    if (val.includes('TWEDDLE')) return 'TW';
    return s;
}

function formatDateItalian(isoDate) {
    if (!isoDate) return '19/12/2025';
    const d = new Date(isoDate + 'T00:00:00');
    if (isNaN(d)) return '19/12/2025';
    return d.toLocaleDateString('it-IT');
}

function handleCostNumericInput(e) {
    let rawValue = e.target.value;
    let cleanValue = rawValue.split(',')[0].replace(/[^0-9]/g, '');
    if (cleanValue !== "") {
        let num = parseInt(cleanValue, 10);
        if (!isNaN(num)) {
            document.getElementById('costLiteral').value = numeroInLettere(num);
        }
    }
    updateAll();
}

function updateAll() {
    const type = document.getElementById('docType').value;
    const number = padNumber(document.getElementById('docNumber').value);
    const supplier = document.getElementById('supplier').value;
    const initials = getSupplierInitials(supplier);
    const lineInput = document.getElementById('lineCode').value.trim().toUpperCase();
    const line = lineInput ? `SA13-00${lineInput}` : '';
    const client = document.getElementById('customerName').value.trim().toUpperCase();
    const country = document.getElementById('countryName').value.trim().toUpperCase();
    const rev = document.getElementById('revisionNum').value;
    const tipoAg = document.getElementById('tipoAg') ? document.getElementById('tipoAg').value : '';
    const numberWithLetter = `${number}${tipoAg}`;

    let fullCode = `${type}${numberWithLetter}- ${initials}`;
    if (line) fullCode += ` - ${line}`;
    if (client) fullCode += ` - ${client}`;
    if (country) fullCode += ` - ${country}`;
    fullCode += ` - Rev. ${rev}`;

    document.getElementById('codePreview').innerText = fullCode;
    document.querySelectorAll('.code-val').forEach(el => el.innerText = fullCode);
    document.querySelectorAll('.rev-val').forEach(el => el.innerText = rev);
    document.querySelectorAll('.order-val').forEach(el => el.innerText = document.getElementById('orderNumber').value);
    document.querySelectorAll('.supplier-name-val').forEach(el => el.innerText = supplier);
    document.querySelectorAll('.prod-type-val').forEach(el => el.innerText = type);
    document.querySelectorAll('.equip-val').forEach(el => el.innerText = document.getElementById('prodEquip').value || '-');
    document.querySelectorAll('.lang-val').forEach(el => el.innerText = document.getElementById('prodLang').value || '-');

    const equipNote = document.getElementById('equipNoteInput').value;
    document.getElementById('pdfEquipNotes').innerText = equipNote;

    const valNumeric = document.getElementById('costNumeric').value;
    const valLiteral = document.getElementById('costLiteral').value;
    document.getElementById('spanCostNumeric').innerText = valNumeric;
    document.getElementById('spanCostLiteral').innerText = valLiteral;

    const iso = document.getElementById('deliveryDate') ? document.getElementById('deliveryDate').value : '';
    const headerDate = iso ? new Date(iso + 'T00:00:00').toLocaleDateString('it-IT') : new Date().toLocaleDateString('it-IT');
    document.querySelectorAll('.date-val').forEach(el => el.innerText = headerDate);

    document.getElementById('pdfDeliveryText').innerText = `Il fornitore si impegna a consegnare i prodotti finiti entro e non oltre il ${formatDateItalian(iso)}, salvo diverso accordo scritto.\nLa mancata consegna nei termini concordati dar√† diritto a IMA Life di:\n\n- Rivedere il budget assegnato.\n- Rescindere il contratto in caso di ritardi gravi.`;
}

function resetForm() {
    document.getElementById('docNumber').value = '0000';
    document.getElementById('lineCode').value = '';
    document.getElementById('customerName').value = '';
    document.getElementById('countryName').value = '';
    document.getElementById('revisionNum').value = '1';
    document.getElementById('orderNumber').value = '000000000';
    document.getElementById('costNumeric').value = '00.000,00';
    document.getElementById('costLiteral').value = 'xxxxxxxxx';
    document.getElementById('equipNoteInput').value = '';
    updateAll();
}

document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('costNumeric').addEventListener('input', handleCostNumericInput);
    const inputs = ['docType', 'docNumber', 'tipoAg', 'supplier', 'lineCode', 'customerName', 'countryName', 'revisionNum', 'orderNumber', 'prodEquip', 'prodLang', 'deliveryDate', 'costLiteral', 'equipNoteInput'];
    inputs.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.addEventListener('input', updateAll);
    });
    updateAll();
});

async function generatePDF() {
    updateAll();
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'mm', 'a4');
    const pages = document.querySelectorAll('.pdf-page');

    for (let i = 0; i < pages.length; i++) {
        const canvas = await html2canvas(pages[i], {
            scale: 2,
            useCORS: true,
            logging: false,
            backgroundColor: '#ffffff'
        });

        const imgData = canvas.toDataURL('image/png');
        const imgWidth = 210;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        if (i > 0) doc.addPage();
        doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
    }

    doc.save("Accordo_IMA_Life.pdf");
}
const toggleBtn = document.getElementById('togglePdfBtn');
toggleBtn.addEventListener('click', () => {
    const pdfDiv = document.getElementById('pdfPages');
    if (pdfDiv.style.display === 'none') {
        pdfDiv.style.display = 'block';
    } else {
        pdfDiv.style.display = 'none';
    }
});

</script>

</body>
</html>
